<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="img/favicon.png">
  <title>Payment Status</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
      color: #e0e0e0;
      padding: 50px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    h1 {
      font-size: 28px;
      margin-top: 15px;
      background: linear-gradient(90deg, #00ff99, #00ccff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    @keyframes glowText {
      from { text-shadow: 0 0 8px #00ff99; }
      to   { text-shadow: 0 0 16px #00ccff; }
    }

    p {
      font-size: 18px;
      margin: 8px 0;
    }

    .contact {
      font-size: 20px;
      font-weight: bold;
      margin-top: 15px;
      color: #bbb;
    }

    /* Loader circle */
    .loader {
      border: 6px solid rgba(255,255,255,0.1);
      border-top: 6px solid #00ff99;
      border-radius: 50%;
      width: 100px;
      height: 100px;
      animation: spin 1s linear infinite;
      margin: 40px auto;
      box-shadow: 0 0 20px rgba(0,255,153,0.4);
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Success tick */
    .tick {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #00ff99;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 40px auto;
      animation: pop 0.5s ease forwards;
      opacity: 0;
      transform: scale(0.5);
      box-shadow: 0 0 25px rgba(0,255,153,0.5);
    }
    .tick:after {
      content: '✔';
      font-size: 70px;
      color: #0d0d0d;
      font-weight: bold;
    }
    @keyframes pop {
      to { opacity: 1; transform: scale(1); }
    }

    #status {
      font-weight: bold;
      font-size: 20px;
      margin-top: 10px;
      transition: color 0.5s ease, opacity 0.5s ease;
    }
    #status.success { color: #00ff99; }
    #status.failed { color: #ff4444; }
  </style>
</head>
<body>
  <div id="loader" class="loader"></div>
  <div id="tick" class="tick" style="display:none;"></div>

  <h1 id="headline">Processing Payment…</h1>
  <p>Thank you for purchasing <span id="planName"></span></p>
  <p>Your Payment ID: <strong id="paymentId"></strong></p>
  <p class="contact">We will contact you within 24 Hours</p>
  <p><span id="status">Verifying…</span></p>
   <a href="transactionHistory.html" class="transaction-btn">View Transaction</a>

<style>
.transaction-btn {
  display: inline-block;
  padding: 10px 20px;
  background-color: #ff4d4d;
  color: #fff;
  text-decoration: none;
  border-radius: 12px;
  font-weight: bold;
  transition: background 0.2s ease, transform 0.2s ease;
}

.transaction-btn:hover {
  background-color: #ff1a1a;
  transform: translateY(-2px);
}
</style>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC1705Xy74qwXt8aOgvZGBIYs8uMU6u3js",
      authDomain: "ironnrootfitness-5156e.firebaseapp.com",
      projectId: "ironnrootfitness-5156e",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get query params
    const params = new URLSearchParams(window.location.search);
    const paymentId = params.get("paymentId");
    document.getElementById("paymentId").innerText = paymentId || "Unknown";

    const planNames = {
      personal_nutrition_plan: "Personal Nutrition Plan",
      personal_workout_plan: "Personal Workout Plan",
      ultimate_personal_coaching: "Ultimate Personal Coaching"
    };

    const collectionsToCheck = [
      "personal_nutrition_plan",
      "personal_workout_plan",
      "ultimate_personal_coaching"
    ];

    let found = false;
    let unsubscribeFns = [];

    collectionsToCheck.forEach(col => {
      const q = query(
        collection(db, col),
        where("paymentId", "==", paymentId)
      );

      const unsubscribe = onSnapshot(q, (snapshot) => {
        if (found) return;

        snapshot.forEach((doc) => {
          if (found) return;
          found = true;

          const data = doc.data();
          console.log("✅ Found payment in", col, data);

          const statusEl = document.getElementById("status");
          const headline = document.getElementById("headline");
          const loader = document.getElementById("loader");
          const tick = document.getElementById("tick");
          const planNameEl = document.getElementById("planName");

          planNameEl.innerText = planNames[col] || "Your Plan";

          if (data.status === "success") {
            statusEl.innerText = "Payment Successful";
            statusEl.className = "success";
            headline.innerText = "Payment Successful!";
            loader.style.display = "none";
            tick.style.display = "flex";
          } else if (data.status === "failed") {
            statusEl.innerText = "Payment Failed ❌";
            statusEl.className = "failed";
            headline.innerText = "Payment Failed";
            loader.style.display = "none";
          } else {
            statusEl.innerText = "Processing…";
            statusEl.className = "";
            headline.innerText = "Processing Payment…";
          }

          unsubscribeFns.forEach(fn => fn());
        });
      });

      unsubscribeFns.push(unsubscribe);
    });
  </script>
</body>
</html>
